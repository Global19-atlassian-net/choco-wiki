# Quick Deployment Environment Setup

This document contains instructions for importing the QuickDeploy appliance/VM, or creating a VM and attaching the QuickDeploy disk image to it.
You will receive a download link via email for an archive of the VM image. Once you have this downloaded, it will be ready for extraction and import into your environment.

<!-- TOC -->

- [Setup Considerations](#setup-considerations)
- [Import Virtual Environment](#import-virtual-environment)
  - [Platform: Hyper-V (Appliance)](#platform-hyper-v-appliance)
  - [Platform: Hyper-V (VHD file)](#platform-hyper-v-vhd-file)
  - [Platform: VMware (OVA template)](#platform-vmware-ova-template)
  - [Platform: VMware (VMDK file)](#platform-vmware-vmdk-file)
- [Other Considerations for Virtual Environment](#other-considerations-for-virtual-environment)
- [Virtual Environment Setup](#virtual-environment-setup)
- [SSL Setup and Considerations](#ssl-setup-and-considerations)
- [Firewall Changes](#firewall-changes)
- [Client Installation](#client-installation)
- [Database Password Changes](#database-password-changes)
  - [1. Change the database access credentials](#1-change-the-database-access-credentials)
  - [2. Reinstall the chocolatey-management-service package](#2-reinstall-the-chocolatey-management-service-package)
  - [3. Reinstall the chocolatey-management-web package](#3-reinstall-the-chocolatey-management-web-package)

<!-- /TOC -->

## Setup Considerations

The following are points to keep in mind during initial setup:

* You will need access to AWS to download the environment (specifically `s3.amazonaws.com`).
* Hostname/FQDN changes will invalidate all scripts and certificates. Thus, if you plan to change the hostname, you must do so prior to running any setup scripts. If you run into issues, refer to the README file on the desktop of the VM.
* Self-signed certificates are generated by default. If you plan to use your own certificates, please reach out to Support for assistance.
* The back-end database is configured with no outbound connections - if you plan to change this, please reach out to Support for assistance.
* If you intend to use Nexus outside of your corporate network without the use of a VPN, you will be required to configure RBAC on the repositories housed inside of the repository server. This is to ensure that the packages stored on the server are not publicly accessible without authentication.

## Import Virtual Environment

### Platform: Hyper-V (Appliance)

1. Download zip archive containing the Hyper-V VM directory structure, and unzip it to the directory you wish to store it in

2. Open Hyper-V Manager, and select `Import Virtual Machine` from the right sidebar (or  Action menu), and choose the folder you extracted from the above archive (e.g. ChocoServer).

3. Increase the size of the VHD, for example, to 100GB. Increase to what you feel comfortable with.

```powershell
Resize-VHD -Path C:\path\to\QuickDeploy Environment.vhd -SizeInBytes 100GB
```

4. Windows 10 and Windows Server 2016/2019 version of Hyper-V now come with built-in support for Hyper-V Integration Services, as they automatically get pushed to guest VM's. In older versions of Hyper-V, you should see an option to "Insert Integration Services Setup Disk". You can use this option to install and enable Hyper-V Integration Services.

Video Summary:

![QDE Hyper-V Appliance Import](images/quickdeploy/QDE-hypervapp.gif)

### Platform: Hyper-V (VHD file)

1. Download VHD from provided link, and unzip it to the directory you wish to store it in
2. Increase the size of the VHD, for example to 100GB. Increase to what you feel comfortable with.

```powershell
Resize-VHD -Path C:\path\to\QuickDeploy Environment.vhd -SizeInBytes 100GB
```

3. Open Hyper-V Manager
4. Create a new VM
5. If prompted, choose a `Generation 1` virtual machine option
6. Set startup memory to `8192 MB` (you can specify this later as well)
7. When asked to create a new disk or use an existing one, select the `Use existing virtual disk` option and browse to the VHD you unzipped in Step 1
8. Adjust the hardware specifications of the VM. For a performant system, the following are recommended:
    - 4 vCPUs
    - 8 GB RAM
9. Windows 10 and Windows Server 2016/2019 version of Hyper-V now come with built-in support for Hyper-V Integration Services, as they automatically get pushed to guest VM's. In older versions of Hyper-V, you should see an option to `Insert Integration Services Setup Disk`. You can use this option to install and enable Hyper-V Integration Services.

Video Summary:

![QDE Hyper-V VHD](images/quickdeploy/QDE-hyperv.gif)

### Platform: VMware (OVA template)

1. Download OVA file and unzip it to the directory you wish to store it
2. Review instructions for deploying a VM from an OVA file [here](https://docs.vmware.com/en/VMware-vSphere/6.0/com.vmware.vsphere.html.hostclient.doc/GUID-FBEED81C-F9D9-4193-BDCC-CC4A60C20A4E_copy.html)
3. Adjust settings of newly imported VM to our recommended:
    - 4 vCPUs
    - 8 GB RAM
4. Install VMWare Tools on the VM once booted (this will require a reboot)

### Platform: VMware (VMDK file)

1. Download VMDK from provided link, and unzip it to the directory you wish to store it
2. For ESX/ESXi, open vSphere and upload the downloaded VMDK to your datastore
3. Create a new VM
4. When prompted for OS type, choose Windows Server 2019 (if available), or Windows 10
5. If prompted for boot firmware, choose `Legacy BIOS` (**not** UEFI)
6. When asked to create a new disk or attach, delete the default disk, select attach, and browse to the VMDK you uploaded
7. Adjust the hardware specifications of the VM. For a performant system, the following are recommended:
    - 4 vCPUs
    - 8 GB RAM
8. Install VMWare Tools on the VM once booted (this will require a reboot)

Video Summary:

![QDE VMware VMDK](images/quickdeploy/QDE-vmdk.gif)


## Other Considerations for Virtual Environment

* DNS Settings
* Set static IP address
* What if they add it to AD?

## Virtual Environment Setup

On the desktop of your QDE VM, there is a `Readme.html` file, that will guide you through the rest of the setup process once you are logged in. A version of this readme file can be found [here](QuickDeploymentDesktopReadme.md)

## SSL Setup and Considerations

See [[QDE SSL/TLS Setup|QuickDeploymentSslSetup]].

## Firewall Changes

See [[QDE Firewall Changes|QuickDeploymentFirewallChanges]].

## Client Installation

See [[QDE Client Setup|QuickDeploymentClientSetup]].

## Database Password Changes

The database credentials are currently pre-set. If you would like to change the credentials associated with the database, you will need to follow these steps.

### 1. Change the database access credentials

### 2. Reinstall the chocolatey-management-service package

```powershell
choco uninstall chocolatey-management-service -y
choco install chocolatey-management-service -y --package-parameters-sensitive=”’/ConnectionString=””Server=localhost\SQLEXPRESS;Database=ChocolateyManagement;User ID=ChocoUser;Password=NewPassword;””’”
```

### 3. Reinstall the chocolatey-management-web package

```powershell
choco uninstall chocolatey-management-web -y
Choco install chocolatey-management-web -y --package-parameters-sensitive=”’/ConnectionString=””Server=Localhost\SQLEXPRESS;Database=ChocolateyManagement;User ID=ChocoUser;Password=NewPassword;””’”
```
